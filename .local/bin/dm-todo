#!/bin/bash

# initial options
OPTIONS=("todos" "dones" "exit")

while true; do
    # choose between todos, dones, and exit
    CHOICE=$(printf '%s\n' "${OPTIONS[@]}" | dmenu -i -l 20 -p "choose todos, dones or exit: ")

    # if exit is chosen, break the loop
    if [[ "$CHOICE" == "exit" ]]; then
        break
    fi

    # read the chosen file into an array
    mapfile -t lines < ~/.local/share/dm-todo/$CHOICE

    # set the prompt based on the choice
    if [[ "$CHOICE" == "todos" ]]; then
        PROMPT="mark done"
    else
        PROMPT="mark todo"
    fi

    # choose what is done
DONE=$(printf '%s\n' "${lines[@]}" | dmenu -i -l 20 -p "$PROMPT: ")

    # only proceed if DONE is not empty
    if [[ -n "$DONE" ]]; then
        # find the line number in the array
        for i in "${!lines[@]}"; do
            if [[ "${lines[$i]}" = "${DONE}" ]]; then
                index=$i
                break
            fi
        done

        # remove the line from the array
        unset 'lines[$index]'

        # write the array back to the file
        printf "%s\n" "${lines[@]}" > ~/.local/share/dm-todo/$CHOICE

        # add the done item to the other file
        if [[ "$CHOICE" = "todos" ]]; then
            echo "$DONE" >> ~/.local/share/dm-todo/dones
        else
            echo "$DONE" >> ~/.local/share/dm-todo/todos
        fi
    fi
done

